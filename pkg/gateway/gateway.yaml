# gateway模块配置文件
# 模块名称: gateway
# 包名: gateway  
# 描述: API网关模块
# 生成时间: 2025-12-02 09:21:01
# 注意: 此文件由配置生成器自动生成

# 模块名称
module-name: gateway
# 网关名称
name: Go RPC Gateway
# 是否启用网关
enabled: true
# 是否启用调试模式
debug: true
# 版本号
version: v1.0.0
# 环境 (dev, test, prod)
environment: dev
# JSON序列化配置
json:
    use-proto-names: true
    emit-unpopulated: true
    discard-unknown: true
# HTTP服务器配置
http:
    # 模块名称
    module-name: server
    host: 0.0.0.0
    port: 8080
    network: tcp4
    read-timeout: 30
    write-timeout: 30
    idle-timeout: 60
    max-header-bytes: 1048576
    enable-tls: false
    tls:
        cert-file: ""
        key-file: ""
        ca-file: ""
    headers:
        x-server: go-config
    enable-gzip-compress: true
# GRPC配置
grpc:
    server:
        host: 0.0.0.0
        port: 9090
        network: tcp4
        max-recv-msg-size: 4194304
        max-send-msg-size: 4194304
        keepalive-time: 30
        keepalive-timeout: 10
        connection-timeout: 5
        enable-reflection: true
    clients: {}
# 缓存配置(包含Redis)
cache:
    # 模块名称
    module-name: default
    type: memory
    # 是否启用网关
    enabled: true
    default-ttl: 30m0s
    key-prefix: 'cache:'
    serializer: json
    memory:
        # 模块名称
        module-name: memory
        capacity: 1000
        default-ttl: 30m0s
        cleanup-size: 100
        max-size: 0
    ristretto:
        # 模块名称
        module-name: ristretto
        num-counters: 10000000
        max-cost: 1073741824
        buffer-items: 64
        metrics: true
        ignore-internal-cost: false
        key-to-hash: true
        cost: 1
    redis:
        # 模块名称
        module-name: redis
        addr: 127.0.0.1:6379
        addrs:
            - 127.0.0.1:6379
        username: default
        password: redis123456
        db: 0
        max-retries: 3
        pool-size: 10
        min-idle-conns: 0
        max-idle-conns: 20
        max-conn-age: 30m0s
        dial-timeout: 0s
        pool-timeout: 4s
        idle-timeout: 5m0s
        read-timeout: 3s
        write-timeout: 3s
        min-retry-backoff: 8ms
        max-retry-backoff: 512ms
        cluster-mode: false
    sharded:
        # 模块名称
        module-name: sharded
        shard-count: 32
        base-type: memory
        hash-func: fnv
        load-balancer: consistent_hash
    two-level:
        # 模块名称
        module-name: twolevel
        l1-type: memory
        l2-type: redis
        l1-ttl: 5m0s
        l2-ttl: 30m0s
        sync-strategy: write_through
        l1-size: 1000
        l2-size: 10000
        promote-threshold: 2
    expiring:
        # 模块名称
        module-name: expiring
        cleanup-interval: 5m0s
        default-ttl: 30m0s
        max-size: 10000
        eviction-policy: lru
        enable-lazy-expiry: true
        max-memory-usage: 104857600
# 数据库统一配置
database:
    type: mysql
    # 是否启用网关
    enabled: true
    default: mysql
    mysql:
        # 模块名称
        module-name: mysql
        host: localhost
        port: "3306"
        config: charset=utf8mb4&parseTime=True&loc=Local
        log-level: info
        db-name: test
        username: root
        password: mysql_password
        max-idle-conns: 10
        max-open-conns: 100
        conn-max-idle-time: 300
        conn-max-life-time: 3600
    postgresql:
        # 模块名称
        module-name: postgresql
        host: localhost
        port: "5432"
        config: sslmode=disable
        log-level: info
        db-name: postgres
        username: postgres
        password: postgres_password
        max-idle-conns: 10
        max-open-conns: 100
        conn-max-idle-time: 300
        conn-max-life-time: 3600
    sqlite:
        # 模块名称
        module-name: sqlite
        config: _foreign_keys=on
        log-level: info
        db-path: ./data.db
        vacuum: false
        max-idle-conns: 10
        max-open-conns: 1
        conn-max-idle-time: 300
        conn-max-life-time: 3600
# Etcd配置
etcd:
    # 模块名称
    module-name: etcd
    hosts:
        - 127.0.0.1:2379
    key: app/config
    id: 1
    user: etcd_user
    pass: etcd_password
    cert-file: /etc/etcd/client.crt
    cert-key-file: /etc/etcd/client.key
    ca-cert-file: /etc/etcd/ca.crt
    insecure-skip-verify: true
    namespace: default
    dial-timeout: 5
    request-timeout: 10
# Kafka配置
kafka:
    brokers: 127.0.0.1:9092
    topic: default-topic
    group-id: default-group
    username: kafka_user
    password: kafka_password
    partition: 0
    offset: latest
    try-times: 3
    sync-es-topic: sync-es-topic
    # 模块名称
    module-name: kafka
# 对象存储统一配置
oss:
    type: minio
    # 是否启用网关
    enabled: true
    default: minio
    minio:
        endpoint: localhost
        access-key: minioadmin
        secret-key: minioadmin
        bucket: my-bucket
        # 模块名称
        module-name: minio
        use-ssl: false
    s3:
        endpoint: https://s3.amazonaws.com
        region: us-east-1
        access-key: demo_access_key
        secret-key: s3_secret_key
        bucket-prefix: demo-bucket
        session-token: ""
        use-ssl: true
        path-style: false
        # 模块名称
        module-name: s3
    aliyun:
        access-key: demo_access_key
        secret-key: demo_secret_key
        endpoint: oss-cn-hangzhou.aliyuncs.com
        bucket: demo-bucket
        region: oss-cn-hangzhou
        replace-original-host: oss-cn-hangzhou.aliyuncs.com
        replace-later-host: cdn.example.com
        # 模块名称
        module-name: aliyun-oss
    boltdb:
        path: ./data/storage.db
        # 模块名称
        module-name: boltdb
# MQTT配置
mqtt:
    endpoint: tcp://127.0.0.1:1883
    client-id: go-config-mqtt-client
    protocol-version: 4
    keep-alive: 60
    max-reconnect-interval: 300
    ping-timeout: 10
    write-timeout: 10
    connect-timeout: 30
    username: mqtt_user
    password: mqtt_password
    clean-session: true
    auto-reconnect: true
    will-topic: ""
    # 模块名称
    module-name: mqtt
# Elasticsearch配置
elasticsearch:
    endpoint: http://127.0.0.1:9200
    health-check: 10
    sniff: false
    gzip: false
    timeout: 10s
    # 模块名称
    module-name: elasticsearch
# SMTP邮件服务配置
smtp:
    # 模块名称
    module-name: smtp
    # 是否启用网关
    enabled: true
    smtp-host: 127.0.0.1
    smtp-port: 587
    username: smtp_user
    password: smtp_password
    from-address: noreply@example.com
    to-addresses:
        - admin@example.com
    enable-tls: true
    headers: {}
    pool-size: 5
# 健康检查配置
health:
    # 模块名称
    module-name: health
    # 是否启用网关
    enabled: true
    path: /health
    port: 8080
    timeout: 30
    redis:
        # 是否启用网关
        enabled: false
        path: /health/redis
        timeout: 5
    mysql:
        # 是否启用网关
        enabled: false
        path: /health/mysql
        timeout: 5
# 监控配置
monitoring:
    # 模块名称
    module-name: monitoring
    # 是否启用网关
    enabled: false
    prometheus:
        # 模块名称
        module-name: prometheus
        # 是否启用网关
        enabled: false
        path: /metrics
        port: 9090
        endpoint: http://localhost:9090
        push-gateway:
            # 是否启用网关
            enabled: false
            endpoint: http://localhost:9091
            job-name: go-rpc-gateway
        scraping:
            interval: 15s
            timeout: 10s
            metrics-path: /metrics
    grafana:
        # 模块名称
        module-name: grafana
        # 是否启用网关
        enabled: false
        endpoint: http://localhost:3000
        username: admin
        password: admin
        api-key: demo_api_key
        datasource:
            type: prometheus
            url: http://localhost:9090
            # 数据库统一配置
            database: prometheus
            username: prometheus_user
            password: prometheus_password
        dashboard:
            import-path: ""
            auto-import: false
            templates: []
            refresh-interval: 30s
        alerting:
            # 是否启用网关
            enabled: false
            webhooks: []
            channels: []
    jaeger:
        # 模块名称
        module-name: jaeger
        # 是否启用网关
        enabled: false
        endpoint: http://localhost:14268/api/traces
        service-name: go-rpc-gateway
        sample-rate: 0.1
        agent:
            host: localhost
            port: 6832
        collector:
            endpoint: http://localhost:14268/api/traces
            username: jaeger_user
            password: jaeger_password
        sampling:
            type: probabilistic
            param: 0.1
            max-traces-per-second: 100
            operation-sampling: []
        tags: {}
    metrics:
        # 是否启用网关
        enabled: true
        request-count: true
        duration: true
        response-size: true
        request-size: true
        buckets:
            - 0.001
            - 0.01
            - 0.1
            - 0.3
            - 0.6
            - 1
            - 3
            - 6
            - 9
            - 20
            - 30
            - 60
            - 90
            - 120
        enable-open-metrics: false
        custom-metrics: []
    alerting:
        # 是否启用网关
        enabled: false
        rules: []
        webhooks: []
        email:
            # 是否启用网关
            enabled: false
            smtp-host: ""
            smtp-port: 0
            username: ""
            password: ""
            from: ""
            to: []
            tls: false
        slack:
            # 是否启用网关
            enabled: false
            token: ""
            channel: ""
            username: ""
            icon-emoji: ""
# 安全配置
security:
    # 模块名称
    module-name: security
    # 是否启用网关
    enabled: true
    # JWT配置
    jwt:
        # 是否启用网关
        enabled: false
        secret: jwt_secret_key_please_change_in_production
        expiry: 24
        issuer: go-rpc-gateway
        algorithm: HS256
    auth:
        # 是否启用网关
        enabled: false
        type: bearer
        header-name: Authorization
        token-prefix: 'Bearer '
        basic:
            users: []
        bearer:
            tokens: []
        apikey:
            keys: []
            header-name: X-API-Key
            query-param: api_key
        custom:
            header-name: ""
            expected-value: ""
            headers: {}
    protection:
        # Swagger配置
        swagger:
            # 是否启用网关
            enabled: false
            auth-required: false
            auth-type: basic
            ip-whitelist: []
            require-https: false
            username: ""
            password: ""
        pprof:
            # 是否启用网关
            enabled: false
            auth-required: true
            auth-type: basic
            ip-whitelist:
                - 127.0.0.1
                - ::1
            require-https: true
            username: admin
            password: ""
        metrics:
            # 是否启用网关
            enabled: false
            auth-required: false
            auth-type: ""
            ip-whitelist: []
            require-https: false
            username: ""
            password: ""
        # 健康检查配置
        health:
            # 是否启用网关
            enabled: false
            auth-required: false
            auth-type: ""
            ip-whitelist: []
            require-https: false
            username: ""
            password: ""
        api:
            # 是否启用网关
            enabled: true
            auth-required: false
            auth-type: ""
            ip-whitelist: []
            require-https: false
            username: ""
            password: ""
# 中间件配置
middleware:
    # 模块名称
    module-name: middleware
    # 是否启用网关
    enabled: true
    logging:
        # 模块名称
        module-name: logging
        # 是否启用网关
        enabled: true
        level: info
        format: json
        output: stdout
        file-path: /var/log/app.log
        max-size: 100
        max-backups: 3
        max-age: 28
        compress: true
        skip-paths:
            - /health
            - /metrics
            - /favicon.ico
            - /ping
            - /readiness
            - /liveness
        enable-request: true
        enable-response: false
        max-body-size: 2048
        sensitive-mask: '***REDACTED***'
        sensitive-keys:
            - password
            - passwd
            - token
            - access_token
            - refresh_token
            - secret
            - authorization
            - api_key
            - apikey
            - mobile
            - phone
            - id_card
            - credit_card
        loggable-content-types:
            - application/json
            - application/xml
            - application/x-www-form-urlencoded
            - text/
    recovery:
        # 模块名称
        module-name: recovery
        # 是否启用网关
        enabled: true
        enable-stack: true
        stack-size: 4096
        enable-debug: false
        error-message: 服务器内部错误
        log-level: error
        enable-notify: false
        print-stack: true
    tracing:
        # 模块名称
        module-name: tracing
        # 是否启用网关
        enabled: false
        service-name: go-rpc-gateway
        service-version: 1.0.0
        # 环境 (dev, test, prod)
        environment: development
        endpoint: http://localhost:9411/api/v2/spans
        exporter-type: zipkin
        exporter-endpoint: http://localhost:9411/api/v2/spans
        sample-rate: 0.1
        sampler-type: probability
        sampler-probability: 0.1
        sampler-rate: 0.1
        headers:
            - Authorization
            - User-Agent
        attributes: {}
    metrics:
        # 模块名称
        module-name: metrics
        # 是否启用网关
        enabled: false
        path: /metrics
        namespace: gateway
        subsystem: http
        skip-paths:
            - /health
        buckets:
            - 0.005
            - 0.01
            - 0.025
            - 0.05
            - 0.1
            - 0.25
            - 0.5
            - 1
            - 2.5
            - 5
            - 10
        request-count: true
        duration: true
        request-size: true
        response-size: true
    request-id:
        # 模块名称
        module-name: requestid
        # 是否启用网关
        enabled: true
        header-name: X-Request-ID
        generator: uuid
    i18n:
        # 模块名称
        module-name: i18n
        # 是否启用网关
        enabled: false
        default-language: en
        supported-languages:
            - en
            - zh
        language-mapping:
            en-us: en
            zh-cn: zh
        detection-order:
            - header
            - query
            - cookie
            - default
        language-param: lang
        language-header: Accept-Language
        messages-path: ./locales
        custom-message-paths: {}
        enable-fallback: true
        cookie-name: language
    pprof:
        # 模块名称
        module-name: PProf
        # 是否启用网关
        enabled: false
        path-prefix: /debug/pprof
        port: 6060
        enable-profiles:
            cpu: true
            memory: true
            goroutine: true
            block: false
            mutex: false
            heap: true
            allocs: true
            threadcreate: false
            trace: false
        sampling:
            cpu-rate: 100
            memory-rate: 524288
            block-rate: 1
            mutex-fraction: 1
        authentication:
            # 是否启用网关
            enabled: false
            auth-token: ""
            allowed-ips: []
            require-auth: false
            timeout: 30
        gateway:
            # 是否启用网关
            enabled: false
            dev-mode-only: false
            enable-logging: true
            register-web-interface: true
        web-interface:
            # 是否启用网关
            enabled: true
            title: PProf Performance Analysis
            description: Go Performance Profiling Interface
            show-scenarios: true
    circuit-breaker:
        # 模块名称
        module-name: circuit_breaker
        # 是否启用网关
        enabled: true
        failure-threshold: 5
        success-threshold: 2
        timeout: 30000000000
        volume-threshold: 10
        sliding-window-size: 100
        sliding-window-bucket: 1000000000
        prevention-paths:
            - /api/
        exclude-paths:
            - /health
            - /metrics
            - /debug
    alerting:
        # 模块名称
        module-name: alerting
        # 是否启用网关
        enabled: false
        webhooks: []
        channels: []
# CORS配置
cors:
    allowed-origins:
        - '*'
    allowed-methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
    allowed-headers:
        - Origin
        - Content-Length
        - Content-Type
        - Authorization
    max-age: "86400"
    allowed-all-origins: false
    allowed-all-methods: false
    exposed-headers: []
    allow-credentials: true
    options-response-code: 200
    # 模块名称
    module-name: cors
# JWT配置
jwt:
    # 模块名称
    module-name: jwt
    signing-key: go-config-default-key
    expires-time: 604800
    buffer-time: 3600
    use-multipoint: false
    issuer: go-config
    audience: go-config-audience
    algorithm: HS256
    enable-refresh: true
    refresh-token-life: 2592000
    subject: user-token
    custom-claims: {}
# Swagger配置
swagger:
    # 模块名称
    module-name: swagger
    # 是否启用网关
    enabled: true
    json-path: /swagger/doc.json
    ui-path: /swagger
    yaml-path: /swagger/doc.yaml
    spec-path: ./docs/swagger.yaml
    title: API Documentation
    description: API Documentation powered by Swagger UI
    # 版本号
    version: 1.0.0
    contact:
        # 网关名称
        name: API Support
        url: https://example.com/support
        email: support@example.com
    license:
        # 网关名称
        name: MIT
        url: https://opensource.org/licenses/MIT
    auth:
        type: none
        username: ""
        password: ""
        token: ""
        header-name: ""
        header-value: ""
    aggregate:
        # 是否启用网关
        enabled: false
        mode: merge
        services: []
        ui-layout: tabs
# Banner配置
banner:
    # 模块名称
    module-name: banner
    # 是否启用网关
    enabled: true
    template: "\n ██████╗  ██████╗       ██████╗ ██████╗  ██████╗     ██████╗  █████╗ ████████╗███████╗██╗    ██╗ █████╗ ██╗   ██╗\n██╔════╝ ██╔═══██╗      ██╔══██╗██╔══██╗██╔════╝    ██╔════╝ ██╔══██╗╚══██╔══╝██╔════╝██║    ██║██╔══██╗╚██╗ ██╔╝\n██║  ███╗██║   ██║█████╗██████╔╝██████╔╝██║         ██║  ███╗███████║   ██║   █████╗  ██║ █╗ ██║███████║ ╚████╔╝ \n██║   ██║██║   ██║╚════╝██╔══██╗██╔═══╝ ██║         ██║   ██║██╔══██║   ██║   ██╔══╝  ██║███╗██║██╔══██║  ╚██╔╝  \n╚██████╔╝╚██████╔╝      ██║  ██║██║     ╚██████╗    ╚██████╔╝██║  ██║   ██║   ███████╗╚███╔███╔╝██║  ██║   ██║   \n ╚═════╝  ╚═════╝       ╚═╝  ╚═╝╚═╝      ╚═════╝     ╚═════╝ ╚═╝  ╚═╝   ╚═╝   ╚══════╝ ╚══╝╚══╝ ╚═╝  ╚═╝   ╚═╝   "
    title: Go RPC Gateway
    description: A high-performance RPC gateway service
    author: kamalyes
    email: 501893067@qq.com
    website: https://github.com/kamalyes/go-rpc-gateway
# 限流配置
rate-limit:
    # 模块名称
    module-name: ratelimit
    # 是否启用网关
    enabled: true
    strategy: token-bucket
    default-scope: global
    global-limit:
        requests-per-second: 100
        burst-size: 200
        window-size: 1m0s
        block-duration: 1m0s
    routes: []
    ip-rules: []
    user-rules: []
    storage:
        type: memory
        key-prefix: 'rate_limit:'
        clean-interval: 5m0s
        redis: null
    custom-rule-loader: ""
    enable-dynamic-rule: false
    email-alert-config:
        # 是否启用网关
        enabled: false
        to:
            - admin@example.com
        cc: []
        app-name: RateLimit System
        # 环境 (dev, test, prod)
        environment: production
        subject-alert: ⚠️ 风控预警 - {{.AppName}}
        subject-block: "\U0001F6AB 风控封禁 - {{.AppName}}"
        template-alert: "\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>风控预警通知</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f5f5f5;\n        }\n        .email-container {\n            max-width: 600px;\n            margin: 20px auto;\n            background-color: #ffffff;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        }\n        .email-header {\n            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);\n            color: #ffffff;\n            padding: 30px;\n            text-align: center;\n        }\n        .email-header h1 {\n            margin: 0;\n            font-size: 28px;\n            font-weight: 600;\n        }\n        .email-header .icon {\n            font-size: 48px;\n            margin-bottom: 10px;\n        }\n        .email-body {\n            padding: 30px;\n        }\n        .alert-info {\n            background-color: #fff3cd;\n            border-left: 4px solid #ffc107;\n            padding: 15px;\n            margin: 20px 0;\n            border-radius: 4px;\n        }\n        .alert-info h2 {\n            margin: 0 0 10px 0;\n            color: #856404;\n            font-size: 18px;\n        }\n        .info-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n        }\n        .info-table th,\n        .info-table td {\n            padding: 12px;\n            text-align: left;\n            border-bottom: 1px solid #e0e0e0;\n        }\n        .info-table th {\n            background-color: #f8f9fa;\n            font-weight: 600;\n            color: #333;\n            width: 35%;\n        }\n        .info-table td {\n            color: #666;\n        }\n        .metric-card {\n            display: inline-block;\n            width: 48%;\n            margin: 1%;\n            padding: 15px;\n            background-color: #f8f9fa;\n            border-radius: 6px;\n            text-align: center;\n            box-sizing: border-box;\n        }\n        .metric-card .label {\n            font-size: 12px;\n            color: #666;\n            margin-bottom: 5px;\n        }\n        .metric-card .value {\n            font-size: 24px;\n            font-weight: bold;\n            color: #ffc107;\n        }\n        .threshold-bar {\n            width: 100%;\n            height: 30px;\n            background-color: #e0e0e0;\n            border-radius: 15px;\n            overflow: hidden;\n            margin: 20px 0;\n        }\n        .threshold-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #ffc107 0%, #ff9800 100%);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 12px;\n        }\n        .action-section {\n            background-color: #e8f4fd;\n            border-left: 4px solid #2196f3;\n            padding: 15px;\n            margin: 20px 0;\n            border-radius: 4px;\n        }\n        .action-section h3 {\n            margin: 0 0 10px 0;\n            color: #1976d2;\n            font-size: 16px;\n        }\n        .action-section ul {\n            margin: 0;\n            padding-left: 20px;\n        }\n        .action-section li {\n            margin: 8px 0;\n            color: #666;\n        }\n        .email-footer {\n            background-color: #f8f9fa;\n            padding: 20px;\n            text-align: center;\n            color: #999;\n            font-size: 12px;\n        }\n        .email-footer a {\n            color: #2196f3;\n            text-decoration: none;\n        }\n        @media only screen and (max-width: 600px) {\n            .metric-card {\n                width: 100%;\n                margin: 10px 0;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"email-container\">\n        <!-- 邮件头部 -->\n        <div class=\"email-header\">\n            <div class=\"icon\">⚠️</div>\n            <h1>风控预警通知</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">{{.AppName}} - {{.Environment}}</p>\n        </div>\n\n        <!-- 邮件正文 -->\n        <div class=\"email-body\">\n            <!-- 预警信息 -->\n            <div class=\"alert-info\">\n                <h2>⚠️ 检测到异常行为</h2>\n                <p style=\"margin: 5px 0 0 0; color: #856404;\">\n                    用户 <strong>{{.UserID}}</strong> ({{.UserType}}) 的消息发送频率已达到预警阈值\n                </p>\n            </div>\n\n            <!-- 详细信息表格 -->\n            <table class=\"info-table\">\n                <tr>\n                    <th>\U0001F194 用户ID</th>\n                    <td>{{.UserID}}</td>\n                </tr>\n                <tr>\n                    <th>\U0001F464 用户类型</th>\n                    <td>{{.UserType}}</td>\n                </tr>\n                <tr>\n                    <th>\U0001F4CA 分钟计数</th>\n                    <td><strong>{{.MinuteCount}}</strong> 条/分钟</td>\n                </tr>\n                <tr>\n                    <th>\U0001F4CA 小时计数</th>\n                    <td><strong>{{.HourCount}}</strong> 条/小时</td>\n                </tr>\n                <tr>\n                    <th>\U0001F3AF 预警阈值</th>\n                    <td>{{.AlertThreshold}} 条/分钟</td>\n                </tr>\n                <tr>\n                    <th>\U0001F6AB 封禁阈值</th>\n                    <td>{{.BlockThreshold}} 条/分钟</td>\n                </tr>\n                <tr>\n                    <th>\U0001F550 触发时间</th>\n                    <td>{{.Timestamp}}</td>\n                </tr>\n            </table>\n\n            <!-- 统计指标卡片 -->\n            <div style=\"margin: 20px 0;\">\n                <div class=\"metric-card\">\n                    <div class=\"label\">分钟消息数</div>\n                    <div class=\"value\">{{.MinuteCount}}</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"label\">小时消息数</div>\n                    <div class=\"value\">{{.HourCount}}</div>\n                </div>\n            </div>\n\n            <!-- 阈值进度条 -->\n            <div style=\"margin: 20px 0;\">\n                <p style=\"margin: 0 0 8px 0; font-size: 14px; color: #666;\">预警阈值进度</p>\n                <div class=\"threshold-bar\">\n                    <div class=\"threshold-fill\" style=\"width: {{.AlertPercentage}}%;\">\n                        {{.AlertPercentage}}%\n                    </div>\n                </div>\n            </div>\n\n            <!-- 建议操作 -->\n            <div class=\"action-section\">\n                <h3>\U0001F4CB 建议处理措施</h3>\n                <ul>\n                    <li>立即检查用户 {{.UserID}} 的行为日志</li>\n                    <li>确认是否为正常业务操作还是恶意行为</li>\n                    <li>如确认异常，可手动封禁该用户</li>\n                    <li>监控后续行为，防止达到自动封禁阈值</li>\n                    <li>如有必要，调整风控策略参数</li>\n                </ul>\n            </div>\n\n            <!-- 系统信息 -->\n            <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0;\">\n                <p style=\"margin: 0; font-size: 12px; color: #999;\">\n                    \U0001F4CC 此邮件由 {{.AppName}} 风控系统自动发送<br>\n                    \U0001F3E2 环境: {{.Environment}}<br>\n                    \U0001F550 发送时间: {{.Timestamp}}\n                </p>\n            </div>\n        </div>\n\n        <!-- 邮件尾部 -->\n        <div class=\"email-footer\">\n            <p>© 2025 {{.AppName}}. All rights reserved.</p>\n            <p>\n                如有疑问，请联系 <a href=\"mailto:{{.SupportEmail}}\">技术支持</a>\n            </p>\n        </div>\n    </div>\n</body>\n</html>\n"
        template-block: "\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>风控封禁通知</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background-color: #f5f5f5;\n        }\n        .email-container {\n            max-width: 600px;\n            margin: 20px auto;\n            background-color: #ffffff;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        }\n        .email-header {\n            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);\n            color: #ffffff;\n            padding: 30px;\n            text-align: center;\n        }\n        .email-header h1 {\n            margin: 0;\n            font-size: 28px;\n            font-weight: 600;\n        }\n        .email-header .icon {\n            font-size: 48px;\n            margin-bottom: 10px;\n        }\n        .email-body {\n            padding: 30px;\n        }\n        .alert-danger {\n            background-color: #f8d7da;\n            border-left: 4px solid #dc3545;\n            padding: 15px;\n            margin: 20px 0;\n            border-radius: 4px;\n        }\n        .alert-danger h2 {\n            margin: 0 0 10px 0;\n            color: #721c24;\n            font-size: 18px;\n        }\n        .info-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 20px 0;\n        }\n        .info-table th,\n        .info-table td {\n            padding: 12px;\n            text-align: left;\n            border-bottom: 1px solid #e0e0e0;\n        }\n        .info-table th {\n            background-color: #f8f9fa;\n            font-weight: 600;\n            color: #333;\n            width: 35%;\n        }\n        .info-table td {\n            color: #666;\n        }\n        .metric-card {\n            display: inline-block;\n            width: 48%;\n            margin: 1%;\n            padding: 15px;\n            background-color: #f8f9fa;\n            border-radius: 6px;\n            text-align: center;\n            box-sizing: border-box;\n        }\n        .metric-card .label {\n            font-size: 12px;\n            color: #666;\n            margin-bottom: 5px;\n        }\n        .metric-card .value {\n            font-size: 24px;\n            font-weight: bold;\n            color: #dc3545;\n        }\n        .threshold-bar {\n            width: 100%;\n            height: 30px;\n            background-color: #e0e0e0;\n            border-radius: 15px;\n            overflow: hidden;\n            margin: 20px 0;\n        }\n        .threshold-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 12px;\n        }\n        .action-section {\n            background-color: #fff3cd;\n            border-left: 4px solid #ffc107;\n            padding: 15px;\n            margin: 20px 0;\n            border-radius: 4px;\n        }\n        .action-section h3 {\n            margin: 0 0 10px 0;\n            color: #856404;\n            font-size: 16px;\n        }\n        .action-section ul {\n            margin: 0;\n            padding-left: 20px;\n        }\n        .action-section li {\n            margin: 8px 0;\n            color: #666;\n        }\n        .critical-warning {\n            background-color: #fff3cd;\n            border: 2px solid #ffc107;\n            padding: 20px;\n            margin: 20px 0;\n            border-radius: 6px;\n            text-align: center;\n        }\n        .critical-warning .warning-icon {\n            font-size: 48px;\n            margin-bottom: 10px;\n        }\n        .critical-warning h3 {\n            margin: 0 0 10px 0;\n            color: #856404;\n            font-size: 20px;\n        }\n        .email-footer {\n            background-color: #f8f9fa;\n            padding: 20px;\n            text-align: center;\n            color: #999;\n            font-size: 12px;\n        }\n        .email-footer a {\n            color: #2196f3;\n            text-decoration: none;\n        }\n        @media only screen and (max-width: 600px) {\n            .metric-card {\n                width: 100%;\n                margin: 10px 0;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"email-container\">\n        <!-- 邮件头部 -->\n        <div class=\"email-header\">\n            <div class=\"icon\">\U0001F6AB</div>\n            <h1>风控封禁通知</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">{{.AppName}} - {{.Environment}}</p>\n        </div>\n\n        <!-- 邮件正文 -->\n        <div class=\"email-body\">\n            <!-- 严重警告 -->\n            <div class=\"critical-warning\">\n                <div class=\"warning-icon\">⚠️</div>\n                <h3>用户已被自动封禁</h3>\n                <p style=\"margin: 10px 0 0 0; color: #856404; font-weight: 600;\">\n                    检测到严重的频率滥用行为，系统已自动执行封禁操作\n                </p>\n            </div>\n\n            <!-- 封禁信息 -->\n            <div class=\"alert-danger\">\n                <h2>\U0001F6AB 封禁详情</h2>\n                <p style=\"margin: 5px 0 0 0; color: #721c24;\">\n                    用户 <strong>{{.UserID}}</strong> ({{.UserType}}) 因超过最大消息频率阈值被封禁\n                </p>\n            </div>\n\n            <!-- 详细信息表格 -->\n            <table class=\"info-table\">\n                <tr>\n                    <th>\U0001F194 用户ID</th>\n                    <td>{{.UserID}}</td>\n                </tr>\n                <tr>\n                    <th>\U0001F464 用户类型</th>\n                    <td>{{.UserType}}</td>\n                </tr>\n                <tr>\n                    <th>\U0001F4CA 分钟计数</th>\n                    <td><strong style=\"color: #dc3545;\">{{.MinuteCount}}</strong> 条/分钟</td>\n                </tr>\n                <tr>\n                    <th>\U0001F4CA 小时计数</th>\n                    <td><strong style=\"color: #dc3545;\">{{.HourCount}}</strong> 条/小时</td>\n                </tr>\n                <tr>\n                    <th>\U0001F6AB 封禁阈值</th>\n                    <td>{{.BlockThreshold}} 条/分钟</td>\n                </tr>\n                <tr>\n                    <th>\U0001F4C8 超出比例</th>\n                    <td><strong style=\"color: #dc3545;\">{{.ExceedPercentage}}%</strong></td>\n                </tr>\n                <tr>\n                    <th>\U0001F550 封禁时间</th>\n                    <td>{{.Timestamp}}</td>\n                </tr>\n            </table>\n\n            <!-- 统计指标卡片 -->\n            <div style=\"margin: 20px 0;\">\n                <div class=\"metric-card\">\n                    <div class=\"label\">分钟消息数</div>\n                    <div class=\"value\">{{.MinuteCount}}</div>\n                </div>\n                <div class=\"metric-card\">\n                    <div class=\"label\">小时消息数</div>\n                    <div class=\"value\">{{.HourCount}}</div>\n                </div>\n            </div>\n\n            <!-- 阈值进度条 -->\n            <div style=\"margin: 20px 0;\">\n                <p style=\"margin: 0 0 8px 0; font-size: 14px; color: #666;\">封禁阈值进度（已超限）</p>\n                <div class=\"threshold-bar\">\n                    <div class=\"threshold-fill\" style=\"width: 100%;\">\n                        超限 {{.ExceedPercentage}}%\n                    </div>\n                </div>\n            </div>\n\n            <!-- 紧急处理建议 -->\n            <div class=\"action-section\">\n                <h3>\U0001F525 紧急处理措施</h3>\n                <ul>\n                    <li><strong>立即调查</strong>用户 {{.UserID}} 的完整行为日志</li>\n                    <li><strong>确认来源</strong>：是机器人攻击还是误封正常用户</li>\n                    <li><strong>评估影响</strong>：检查是否还有其他受影响的用户</li>\n                    <li><strong>通知相关方</strong>：如确认为攻击，通知安全团队</li>\n                    <li><strong>手动解封</strong>：如确认误封，及时手动解除封禁</li>\n                    <li><strong>调整策略</strong>：根据实际情况优化风控阈值</li>\n                </ul>\n            </div>\n\n            <!-- 后续行动 -->\n            <div style=\"background-color: #e8f4fd; border-left: 4px solid #2196f3; padding: 15px; margin: 20px 0; border-radius: 4px;\">\n                <h3 style=\"margin: 0 0 10px 0; color: #1976d2; font-size: 16px;\">\U0001F4CB 后续跟进</h3>\n                <p style=\"margin: 0; color: #666; line-height: 1.6;\">\n                    1. 在系统中记录此次封禁事件<br>\n                    2. 建立用户行为分析报告<br>\n                    3. 评估是否需要升级风控策略<br>\n                    4. 定期审查封禁用户列表\n                </p>\n            </div>\n\n            <!-- 系统信息 -->\n            <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0;\">\n                <p style=\"margin: 0; font-size: 12px; color: #999;\">\n                    \U0001F4CC 此邮件由 {{.AppName}} 风控系统自动发送<br>\n                    \U0001F3E2 环境: {{.Environment}}<br>\n                    \U0001F550 封禁时间: {{.Timestamp}}<br>\n                    ⚠️ 优先级: <strong style=\"color: #dc3545;\">紧急</strong>\n                </p>\n            </div>\n        </div>\n\n        <!-- 邮件尾部 -->\n        <div class=\"email-footer\">\n            <p>© 2025 {{.AppName}}. All rights reserved.</p>\n            <p>\n                紧急联系: <a href=\"mailto:{{.SecurityEmail}}\">安全团队</a> | \n                技术支持: <a href=\"mailto:{{.SupportEmail}}\">技术支持</a>\n            </p>\n        </div>\n    </div>\n</body>\n</html>\n"
        cooldown-minutes: 5
        max-alerts-per-hour: 20
        support-email: support@example.com
        security-email: security@example.com
# WebSocket通信配置
wsc:
    # 是否启用网关
    enabled: false
    network: tcp4
    node-ip: 0.0.0.0
    node-port: 8080
    path: /ws
    heartbeat-interval: 30
    client-timeout: 90
    message-buffer-size: 256
    websocket-origins:
        - '*'
    read-timeout: 10s
    write-timeout: 10s
    idle-timeout: 2m0s
    max-message-size: 512
    min-rec-time: 2s
    max-rec-time: 1m0s
    rec-factor: 1.5
    auto-reconnect: true
    max-retries: 3
    base-delay: 100ms
    max-delay: 5s
    ack-timeout: 500ms
    ack-max-retries: 3
    enable-ack: false
    backoff-factor: 2
    jitter: true
    retryable-errors:
        - queue_full
        - timeout
        - conn_error
        - channel_closed
    non-retryable-errors:
        - user_offline
        - permission
        - validation
    sse-heartbeat: 0
    sse-timeout: 120
    sse-message-buffer: 100
    performance:
        max-connections-per-node: 10000
        read-buffer-size: 4
        write-buffer-size: 4
        enable-compression: false
        compression-level: 6
        enable-metrics: true
        metrics-interval: 60
        enable-slow-log: true
        slow-log-threshold: 1000
    # 安全配置
    security:
        enable-auth: true
        enable-encryption: false
        enable-rate-limit: true
        max-message-size: 1024
        allowed-user-types:
            - customer
            - agent
            - admin
        blocked-ips: []
        whitelist-ips: []
        enable-ip-whitelist: false
        token-expiration: 3600
        max-login-attempts: 5
        login-lock-duration: 300
        message-encryption:
            # 是否启用网关
            enabled: false
            algorithm: AES-256-GCM
            key: your-32-byte-secret-key-for-aes256
            enable-key-rotate: false
            key-rotate-hours: 24
            compress: true
            encrypt-prefix: 'ENC:'
            backup-keys: 3
        message-rate-limit:
            # 是否启用网关
            enabled: true
            window: 1m0s
            max-messages: 100
            alert-threshold: 80
            block-duration: 5m0s
            use-redis: true
            redis-key-prefix: 'wsc:rate_limit:'
            enable-email-alert: false
            email-alert:
                smtp-host: ""
                smtp-port: 587
                username: ""
                password: ""
                from: ""
                to: []
                enable-tls: true
                subject-alert: '[WebSocket风控预警] 用户消息频率异常'
                subject-block: '[WebSocket风控封禁] 用户已被封禁'
                template-alert: |-
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                            .header { background: #ff9800; color: white; padding: 20px; border-radius: 5px 5px 0 0; }
                            .content { background: #f9f9f9; padding: 20px; border: 1px solid #ddd; border-top: none; }
                            .info-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                            .info-table td { padding: 10px; border-bottom: 1px solid #ddd; }
                            .info-table td:first-child { font-weight: bold; width: 150px; }
                            .footer { background: #f1f1f1; padding: 15px; text-align: center; font-size: 12px; color: #666; }
                            .warning { background: #fff3cd; border-left: 4px solid #ff9800; padding: 12px; margin: 15px 0; }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <div class="header">
                                <h2>⚠️ 消息频率预警 - {{.AppName}}</h2>
                            </div>
                            <div class="content">
                                <div class="warning">
                                    <strong>用户消息发送频率达到预警阈值，请关注该用户行为</strong>
                                </div>
                                <table class="info-table">
                                    <tr><td>用户ID</td><td>{{.UserID}}</td></tr>
                                    <tr><td>用户类型</td><td>{{.UserType}}</td></tr>
                                    <tr><td>当前分钟消息数</td><td><strong style="color: #ff9800; font-size: 18px;">{{.MinuteCount}} 条</strong></td></tr>
                                    <tr><td>当前小时消息数</td><td><strong style="color: #ff9800; font-size: 18px;">{{.HourCount}} 条</strong></td></tr>
                                    <tr><td>触发时间</td><td>{{.TriggerTime}}</td></tr>
                                </table>
                                <p><strong>建议操作：</strong></p>
                                <ul>
                                    <li>立即检查该用户的消息内容</li>
                                    <li>确认是否为恶意刷屏行为</li>
                                    <li>必要时联系用户或执行封禁操作</li>
                                </ul>
                            </div>
                            <div class="footer">
                                <p>此邮件由 {{.AppName}} 自动发送，请勿直接回复</p>
                                <p>Generated at {{.GenerateTime}}</p>
                            </div>
                        </div>
                    </body>
                    </html>
                template-block: "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: #f44336; color: white; padding: 20px; border-radius: 5px 5px 0 0; }\n        .content { background: #f9f9f9; padding: 20px; border: 1px solid #ddd; border-top: none; }\n        .info-table { width: 100%; border-collapse: collapse; margin: 15px 0; }\n        .info-table td { padding: 10px; border-bottom: 1px solid #ddd; }\n        .info-table td:first-child { font-weight: bold; width: 150px; }\n        .footer { background: #f1f1f1; padding: 15px; text-align: center; font-size: 12px; color: #666; }\n        .warning { background: #ffebee; border-left: 4px solid #f44336; padding: 12px; margin: 15px 0; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h2>\U0001F6AB 用户已被封禁 - {{.AppName}}</h2>\n        </div>\n        <div class=\"content\">\n            <div class=\"warning\">\n                <strong>用户消息发送频率超过限制，已被临时封禁</strong>\n            </div>\n            <table class=\"info-table\">\n                <tr><td>用户ID</td><td>{{.UserID}}</td></tr>\n                <tr><td>用户类型</td><td>{{.UserType}}</td></tr>\n                <tr><td>当前分钟消息数</td><td><strong style=\"color: #f44336; font-size: 18px;\">{{.MinuteCount}} 条</strong></td></tr>\n                <tr><td>当前小时消息数</td><td><strong style=\"color: #f44336; font-size: 18px;\">{{.HourCount}} 条</strong></td></tr>\n                <tr><td>封禁时间</td><td>{{.TriggerTime}}</td></tr>\n            </table>\n            <p><strong>紧急处理：</strong></p>\n            <ul>\n                <li>立即审查该用户的所有消息内容</li>\n                <li>评估是否需要永久封禁</li>\n                <li>通知相关运维人员</li>\n                <li>记录异常行为日志</li>\n            </ul>\n        </div>\n        <div class=\"footer\">\n            <p>此邮件由 {{.AppName}} 自动发送，请勿直接回复</p>\n            <p>Generated at {{.GenerateTime}}</p>\n        </div>\n    </div>\n</body>\n</html>"
                app-name: WebSocket消息系统
    # 数据库统一配置
    database:
        # 是否启用网关
        enabled: true
        auto-migrate: true
        table-prefix: wsc_
        log-level: warn
        slow-threshold: 200ms
    logging:
        # 模块名称
        module-name: wsc
        # 是否启用网关
        enabled: true
        level: info
        format: json
        output: stdout
        file-path: /var/log/wsc.log
        max-size: 100
        max-backups: 3
        max-age: 28
        compress: true
        skip-paths:
            - /health
            - /metrics
            - /favicon.ico
            - /ping
            - /readiness
            - /liveness
        enable-request: true
        enable-response: false
        max-body-size: 2048
        sensitive-mask: '***REDACTED***'
        sensitive-keys:
            - password
            - passwd
            - token
            - access_token
            - refresh_token
            - secret
            - authorization
            - api_key
            - apikey
            - mobile
            - phone
            - id_card
            - credit_card
        loggable-content-types:
            - application/json
            - application/xml
            - application/x-www-form-urlencoded
            - text/
