# 完整Gateway配置文件示例
# 包含数据库、Redis、RPC、所有中间件和Swagger

# Gateway 网关配置
gateway:
  module-name: "complete-gateway"
  name: "完整网关服务演示"
  enabled: true
  debug: true
  version: "v1.0.0"
  environment: "development"

  # HTTP服务器配置
  http:
    module-name: "http-server"
    host: "0.0.0.0"
    port: 8080
    grpc-port: 9090
    read-timeout: 30
    write-timeout: 30
    idle-timeout: 60
    max_header_bytes: 1048576
    enable-http: true
    enable-grpc: true
    enable-tls: false
    enable_gzip_compress: true
    headers:
      X-Service: "Complete Gateway"
      X-Version: "v1.0.0"
      X-Environment: "development"
    tls:
      cert-file: ""
      key-file: ""
      ca-file: ""

# 数据库配置
database:
  type: "mysql"
  enabled: true
  default: "mysql"
  
  # MySQL配置
  mysql:
    module-name: "mysql"
    host: "127.0.0.1"
    port: "3306"
    username: "root"
    password: "password123"
    db-name: "gateway_demo"
    config: "charset=utf8mb4&parseTime=True&loc=Local&timeout=10s"
    log-level: "info"
    max-idle-conns: 10
    max-open-conns: 100
    conn-max-idle-time: 300
    conn-max-life-time: 3600
    enable-log: true
    slow-threshold: 2000

# 缓存配置
cache:
  module_name: "gateway-cache"
  type: "memory"
  enabled: true
  default_ttl: "30m"
  key_prefix: "gateway:"
  serializer: "json"
  
  # 内存缓存配置
  memory:
    capacity: 10000
    cleanup_interval: "5m"
    default_expiration: "30m"
  
  # Redis缓存配置（备用）
  redis:
    modulename: "redis-cache"
    addr: "127.0.0.1:6379"
    addrs: ["127.0.0.1:6379"]
    password: ""
    db: 0
    max-retries: 3
    pool-size: 10
    min-idle-conns: 5
    max-conn-age: "30m"
    pool-timeout: "4s"
    idle-timeout: "5m"
    read-timeout: "3s"
    write-timeout: "3s"
    cluster-mode: false

# Redis配置（独立Redis服务）
redis:
  modulename: "main-redis"
  addr: "127.0.0.1:6379"
  addrs: ["127.0.0.1:6379"]
  username: ""
  password: ""
  db: 1
  max-retries: 3
  pool-size: 20
  min-idle-conns: 5
  max-conn-age: "30m"
  pool-timeout: "4s"
  idle-timeout: "5m"
  read-timeout: "3s"
  write-timeout: "3s"
  cluster-mode: false

# CORS配置
cors:
  modulename: "cors"
  allowed-all-origins: true
  allowed-all-methods: true
  allowed-origins: ["*"]
  allowed-methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"]
  allowed-headers: ["Origin", "Content-Length", "Content-Type", "Authorization", "X-Request-ID", "X-Real-IP"]
  max-age: "86400"
  exposed-headers: ["X-Request-ID", "X-Response-Time"]
  allow-credentials: true
  options-response-code: 200

# Swagger配置
swagger:
  enabled: true
  json-path: "/swagger/doc.json"
  ui-path: "/swagger/*any"
  title: "完整Gateway API文档"
  description: "这是一个完整的Gateway服务API文档，包含所有功能演示"
  version: "v1.0.0"
  contact:
    name: "Gateway Team"
    email: "gateway@example.com"
    url: "https://github.com/example/gateway"
  license:
    name: "MIT"
    url: "https://opensource.org/licenses/MIT"

# 健康检查配置
health:
  enabled: true
  path: "/health"
  interval: "30s"
  timeout: 10
  checks:
    database: true
    cache: true
    redis: true

# 监控配置
monitoring:
  module_name: "monitoring"
  enabled: true
  
  # Prometheus配置
  prometheus:
    enabled: true
    path: "/metrics"
    port: 8080
    listen-address: "0.0.0.0:8080"
    gather-interval: "15s"
    
  # Grafana配置
  grafana:
    enabled: false
    endpoint: "http://localhost:3000"
    username: "admin"
    password: "admin"
    
  # Jaeger配置
  jaeger:
    enabled: false
    endpoint: "http://localhost:14268/api/traces"
    
  # 指标配置
  metrics:
    enabled: true
    request_count: true
    duration: true
    response_size: true
    request_size: true
    enable_open_metrics: false
    buckets: [0.001, 0.01, 0.1, 0.3, 0.6, 1, 3, 6, 9, 20, 30, 60, 90, 120]
    
  # 告警配置
  alerting:
    enabled: false
    rules: []
    webhooks: []

# Banner配置
banner:
  enabled: true
  template: ""
  font: "standard"
  color: true

# 日志配置
logging:
  level: "info"
  format: "json"
  output: "stdout"
  enable_caller: true
  enable_stacktrace: true
  sampling:
    enabled: false

# 安全配置
security:
  enabled: true
  rate_limit:
    enabled: true
    max_requests: 1000
    window: "1m"
  cors:
    enabled: true
  headers:
    enabled: true
    frame_options: "DENY"
    content_type_options: true
    xss_protection: true

# 限流配置
ratelimit:
  enabled: true
  max_requests: 1000
  window: "1m"
  storage: "memory"
  key_generator: "ip"

# 恢复中间件配置
recovery:
  enabled: true
  log_stack: true
  print_stack: false

# 请求ID配置
requestid:
  enabled: true
  header_name: "X-Request-ID"
  generator: "uuid"

# 超时配置
timeout:
  enabled: true
  duration: 10
  message: "Request timeout"

# 中间件配置
middleware:
  enabled: true
  order: ["recovery", "requestid", "cors", "ratelimit", "timeout"]
  
  # 自定义中间件
  custom: []