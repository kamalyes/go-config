# wsc模块配置文件
# 模块名称: wsc
# 包名: wsc  
# 描述: WebSocket通信模块
# 生成时间: 2026-02-24 11:15:01
# 注意: 此文件由配置生成器自动生成

# 是否启用该功能 (true/false)
enabled: false
# network (字符串)
network: tcp4
# node ip (字符串)
node-ip: 0.0.0.0
# node port (整数)
node-port: 8080
# path (字符串)
path: /ws
# allow multi login (true/false)
allow-multi-login: true
# max connections per user (整数)
max-connections-per-user: 3
# connection policy (字符串)
connection-policy: kick_old
# send kick notification (true/false)
send-kick-notification: true
# kick notification msg (字符串)
kick-notification-msg: 您的账号在其他设备登录
# heartbeat interval (时间间隔: 如 30s, 5m, 1h)
heartbeat-interval: 30s
# performance metrics interval (时间间隔: 如 30s, 5m, 1h)
performance-metrics-interval: 5m0s
# ack cleanup interval (时间间隔: 如 30s, 5m, 1h)
ack-cleanup-interval: 1m0s
# client timeout (时间间隔: 如 30s, 5m, 1h)
client-timeout: 1m30s
# shutdown base timeout (时间间隔: 如 30s, 5m, 1h)
shutdown-base-timeout: 5s
# shutdown max timeout (时间间隔: 如 30s, 5m, 1h)
shutdown-max-timeout: 1m0s
# message buffer size (整数)
message-buffer-size: 256
# max pending queue size (整数)
max-pending-queue-size: 20000
# 数组[string]
websocket-origins:
    - '*'
# 读取超时时间 (时间间隔: 如 30s, 5m, 1h)
read-timeout: 10s
# 写入超时时间 (时间间隔: 如 30s, 5m, 1h)
write-timeout: 10s
# 空闲超时时间 (时间间隔: 如 30s, 5m, 1h)
idle-timeout: 2m0s
# max message size (整数)
max-message-size: 512
# min rec time (时间间隔: 如 30s, 5m, 1h)
min-rec-time: 2s
# max rec time (时间间隔: 如 30s, 5m, 1h)
max-rec-time: 1m0s
# rec factor (浮点数)
rec-factor: 1.5
# auto reconnect (true/false)
auto-reconnect: true
# ack timeout (时间间隔: 如 30s, 5m, 1h)
ack-timeout: 500ms
# ack max retries (整数)
ack-max-retries: 3
# enable ack (true/false)
enable-ack: false
# message record ttl (时间间隔: 如 30s, 5m, 1h)
message-record-ttl: 24h0m0s
# record cleanup interval (时间间隔: 如 30s, 5m, 1h)
record-cleanup-interval: 30m0s
# sseheartbeat (时间间隔: 如 30s, 5m, 1h)
sse-heartbeat: 30s
# ssetimeout (时间间隔: 如 30s, 5m, 1h)
sse-timeout: 2m0s
# ssemessage buffer (整数)
sse-message-buffer: 100
# redis repository (嵌套配置对象)
redis-repository:
    cleanup-days-ago: 0
    enable-auto-cleanup: false
    online-status:
        key-prefix: 'wsc:online_status:'
        ttl: 1m30s
        cleanup-days-ago: 0
        enable-auto-cleanup: false
    stats:
        key-prefix: 'wsc:stats:'
        ttl: 10m0s
        cleanup-days-ago: 0
        enable-auto-cleanup: false
    workload:
        key-prefix: 'wsc:workload:'
        max-candidates: 50
        work-status:
            # 是否启用该功能 (true/false)
            enabled: false
            granularities:
                - hour
                - day
            retention-days: 90
            async-record: true
            record-timeout: 2
            sync-to-db: true
            sync-interval: 300
    offline-message:
        key-prefix: 'wsc:offline_messages:'
        queue-ttl: 168h0m0s
        auto-store: true
        auto-push: true
        max-count: 50
        cleanup-days-ago: 0
        enable-auto-cleanup: false
    pubsub:
        # 是否启用该功能 (true/false)
        enabled: true
        namespace: 'wsc:pubsub:'
        max-retries: 2
        retry-delay: 100ms
        buffer-size: 100
        ping-interval: 10s
        enable-compression: false
        compression-min-size: 1024
# performance (嵌套配置对象)
performance:
    max-connections-per-node: 10000
    read-buffer-size: 4
    write-buffer-size: 4
    enable-compression: false
    compression-level: 6
    enable-metrics: true
    metrics-interval: 60
    enable-slow-log: true
    slow-log-threshold: 1000
# security (嵌套配置对象)
security:
    enable-auth: true
    enable-encryption: false
    enable-rate-limit: true
    # max message size (整数)
    max-message-size: 1024
    allowed-user-types:
        - customer
        - agent
        - admin
    blocked-ips: []
    whitelist-ips: []
    enable-ip-whitelist: false
    token-expiration: 3600
    max-login-attempts: 5
    login-lock-duration: 300
    message-encryption:
        # 是否启用该功能 (true/false)
        enabled: false
        algorithm: AES-256-GCM
        key: your-32-byte-secret-key-for-aes256
        enable-key-rotate: false
        key-rotate-hours: 24
        compress: true
        encrypt-prefix: 'ENC:'
        backup-keys: 3
    message-rate-limit:
        # 是否启用该功能 (true/false)
        enabled: true
        window: 1m0s
        max-messages: 100
        alert-threshold: 80
        block-duration: 5m0s
        use-redis: true
        redis-key-prefix: 'wsc:rate_limit:'
        enable-email-alert: false
        email-alert:
            smtp-host: ""
            smtp-port: 587
            username: ""
            password: ""
            from: ""
            to: []
            enable-tls: true
            subject-alert: '[WebSocket风控预警] 用户消息频率异常'
            subject-block: '[WebSocket风控封禁] 用户已被封禁'
            template-alert: |-
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                        .header { background: #ff9800; color: white; padding: 20px; border-radius: 5px 5px 0 0; }
                        .content { background: #f9f9f9; padding: 20px; border: 1px solid #ddd; border-top: none; }
                        .info-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                        .info-table td { padding: 10px; border-bottom: 1px solid #ddd; }
                        .info-table td:first-child { font-weight: bold; width: 150px; }
                        .footer { background: #f1f1f1; padding: 15px; text-align: center; font-size: 12px; color: #666; }
                        .warning { background: #fff3cd; border-left: 4px solid #ff9800; padding: 12px; margin: 15px 0; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h2>⚠️ 消息频率预警 - {{.AppName}}</h2>
                        </div>
                        <div class="content">
                            <div class="warning">
                                <strong>用户消息发送频率达到预警阈值，请关注该用户行为</strong>
                            </div>
                            <table class="info-table">
                                <tr><td>用户ID</td><td>{{.UserID}}</td></tr>
                                <tr><td>用户类型</td><td>{{.UserType}}</td></tr>
                                <tr><td>当前分钟消息数</td><td><strong style="color: #ff9800; font-size: 18px;">{{.MinuteCount}} 条</strong></td></tr>
                                <tr><td>当前小时消息数</td><td><strong style="color: #ff9800; font-size: 18px;">{{.HourCount}} 条</strong></td></tr>
                                <tr><td>触发时间</td><td>{{.TriggerTime}}</td></tr>
                            </table>
                            <p><strong>建议操作：</strong></p>
                            <ul>
                                <li>立即检查该用户的消息内容</li>
                                <li>确认是否为恶意刷屏行为</li>
                                <li>必要时联系用户或执行封禁操作</li>
                            </ul>
                        </div>
                        <div class="footer">
                            <p>此邮件由 {{.AppName}} 自动发送，请勿直接回复</p>
                            <p>Generated at {{.GenerateTime}}</p>
                        </div>
                    </div>
                </body>
                </html>
            template-block: "<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .header { background: #f44336; color: white; padding: 20px; border-radius: 5px 5px 0 0; }\n        .content { background: #f9f9f9; padding: 20px; border: 1px solid #ddd; border-top: none; }\n        .info-table { width: 100%; border-collapse: collapse; margin: 15px 0; }\n        .info-table td { padding: 10px; border-bottom: 1px solid #ddd; }\n        .info-table td:first-child { font-weight: bold; width: 150px; }\n        .footer { background: #f1f1f1; padding: 15px; text-align: center; font-size: 12px; color: #666; }\n        .warning { background: #ffebee; border-left: 4px solid #f44336; padding: 12px; margin: 15px 0; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h2>\U0001F6AB 用户已被封禁 - {{.AppName}}</h2>\n        </div>\n        <div class=\"content\">\n            <div class=\"warning\">\n                <strong>用户消息发送频率超过限制，已被临时封禁</strong>\n            </div>\n            <table class=\"info-table\">\n                <tr><td>用户ID</td><td>{{.UserID}}</td></tr>\n                <tr><td>用户类型</td><td>{{.UserType}}</td></tr>\n                <tr><td>当前分钟消息数</td><td><strong style=\"color: #f44336; font-size: 18px;\">{{.MinuteCount}} 条</strong></td></tr>\n                <tr><td>当前小时消息数</td><td><strong style=\"color: #f44336; font-size: 18px;\">{{.HourCount}} 条</strong></td></tr>\n                <tr><td>封禁时间</td><td>{{.TriggerTime}}</td></tr>\n            </table>\n            <p><strong>紧急处理：</strong></p>\n            <ul>\n                <li>立即审查该用户的所有消息内容</li>\n                <li>评估是否需要永久封禁</li>\n                <li>通知相关运维人员</li>\n                <li>记录异常行为日志</li>\n            </ul>\n        </div>\n        <div class=\"footer\">\n            <p>此邮件由 {{.AppName}} 自动发送，请勿直接回复</p>\n            <p>Generated at {{.GenerateTime}}</p>\n        </div>\n    </div>\n</body>\n</html>"
            app-name: WebSocket消息系统
# client attributes (嵌套配置对象)
client-attributes:
    client-id-sources:
        - type: query
          key: client_id
        - type: header
          key: X-Client-ID
    user-id-sources:
        - type: query
          key: user_id
        - type: header
          key: X-User-ID
    user-type-sources:
        - type: query
          key: user_type
        - type: header
          key: X-User-Type
# response headers (嵌套配置对象)
response-headers:
    # 是否启用该功能 (true/false)
    enabled: true
    client-id-key: X-WSC-Client-ID
    node-id-key: X-WSC-Node-ID
    custom-prefix: X-WSC-
    custom-headers: {}
    send-registered-message: false
    registered-message-content: Client registered successfully
# 数据库名称 (嵌套配置对象)
database:
    # 是否启用该功能 (true/false)
    enabled: true
    auto-migrate: true
    table-prefix: wsc_
    log-level: warn
    slow-threshold: 200ms
    connection-record:
        cleanup-days-ago: 30
        enable-auto-cleanup: true
    message-record:
        cleanup-days-ago: 7
        enable-auto-cleanup: true
    compensation:
        enable-auto-compensate: true
        scan-interval: 30s
        batch-size: 120
        max-concurrent: 50
        default-max-retry: 5
        default-retry-interval: 60
        default-priority: 5
        lock-timeout: 5m0s
        cleanup-days-ago: 7
        enable-auto-cleanup: true
# logging (嵌套配置对象)
logging:
    module-name: wsc
    # 是否启用该功能 (true/false)
    enabled: true
    level: debug
    format: json
    prefix: ""
    show-caller: false
    colorful: true
    time-format: 2006-01-02T15:04:05.999999999Z07:00
    output: stdout
    file-path: /var/log/wsc.log
    max-size: 100
    max-backups: 3
    max-age: 28
    compress: true
    skip-paths:
        - /health
        - /metrics
        - /favicon.ico
        - /ping
        - /readiness
        - /liveness
    enable-request: true
    enable-response: false
    max-body-size: 2048
    sensitive-mask: '***REDACTED***'
    sensitive-keys:
        - password
        - passwd
        - token
        - access_token
        - refresh_token
        - secret
        - authorization
        - api_key
        - apikey
        - mobile
        - phone
        - id_card
        - credit_card
    slow-http-threshold: 1000
    slow-grpc-threshold: 1000
    slow-stream-threshold: 5000
    loggable-content-types:
        - application/json
        - application/xml
        - application/x-www-form-urlencoded
        - text/
# batch processing (嵌套配置对象)
batch-processing:
    offline-message-batch-size: 100
    message-pool-buffer-size: 1024
    connection-batch-size: 1000
# channel buffers (嵌套配置对象)
channel-buffers:
    broadcast-buffer-multiplier: 4
    node-message-buffer-multiplier: 4
# retry policy (嵌套配置对象)
retry-policy:
    max-retries: 3
    base-delay: 100ms
    max-delay: 5s
    backoff-factor: 2
    jitter: true
    jitter-percent: 0.1
    retryable-errors:
        - queue_full
        - timeout
        - conn_error
        - channel_closed
    non-retryable-errors:
        - user_offline
        - permission
        - validation
# client capacity (嵌套配置对象)
client-capacity:
    agent: 256
    bot: 128
    customer: 96
    observer: 16
    admin: 256
    vip: 128
    visitor: 64
    system: 256
    default: 64
